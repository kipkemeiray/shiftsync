{# Partial returned by scheduling:on_duty_now â€” no base template #}
{% load tz %}

{% if on_duty_by_location %}
  <div class="row g-0">
    {% for loc_data in on_duty_by_location %}
    <div class="col-12 col-md-6 col-xl-3 border-end">
      <div class="p-3">
        <div class="small fw-semibold text-muted text-uppercase mb-2">
          <i class="bi bi-geo-alt-fill me-1"></i>{{ loc_data.location.name }}
        </div>
        {% if loc_data.assignments %}
          <ul class="list-unstyled mb-0">
            {% for a in loc_data.assignments %}
            <li class="d-flex align-items-center gap-2 mb-2">
              <span class="avatar-circle bg-success text-white rounded-circle d-inline-flex align-items-center justify-content-center flex-shrink-0"
                    style="width:30px;height:30px;font-size:.7rem;font-weight:600">
                {{ a.user.first_name.0 }}{{ a.user.last_name.0 }}
              </span>
              <div>
                <div class="small fw-semibold lh-1">{{ a.user.get_full_name }}</div>
                <div class="text-muted" style="font-size:.7rem">
                  {{ a.shift.required_skill.display_name }} &middot;
                  until {{ a.shift.end_utc|localtime|time:"g:ia" }}
                </div>
              </div>
            </li>
            {% endfor %}
          </ul>
        {% else %}
          <p class="text-muted small mb-0">
            <i class="bi bi-moon-stars me-1"></i>Nobody on shift right now.
          </p>
        {% endif %}
      </div>
    </div>
    {% endfor %}
  </div>
{% else %}
  <p class="text-center text-muted py-4 mb-0">
    <i class="bi bi-moon-stars me-2"></i>No active shifts across any location right now.
  </p>
{% endif %}